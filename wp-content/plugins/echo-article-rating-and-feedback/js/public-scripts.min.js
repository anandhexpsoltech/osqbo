jQuery(document).ready(function(e){function t(t){var r={action:"eprf-update-rating",kb_id:eprf_vars.kb_id,article_id:e(".kb-article-id").prop("id"),rating_value:t,_wpnonce_user_rating_action_ajax:eprf_vars.eprf_rating_nonce};e.ajax({type:"GET",dataType:"json",data:r,url:eprf_vars.ajaxurl,beforeSend:function(e){}}).done(function(r){e("#eprf-current-rating").html(r.message),t<5&&e(".eprf-article-feedback-container--trigger-negative-five").length&&e(document.body).trigger("open_article_feedback_form"),t<4&&e(".eprf-article-feedback-container--trigger-negative-four").length&&e(document.body).trigger("open_article_feedback_form"),t<4&&e(".eprf-article-feedback-container--trigger-dislike").length&&e(document.body).trigger("open_article_feedback_form"),e(".eprf-stars-container").length&&(e(".eprf-stars-container").data("average",t).trigger("update_view"),e(".eprf-stars-container").addClass("disabled")),void 0!==r.rating&&e(".eprf-like-dislike-module__buttons").length&&r.rating.statistic&&(e(".eprf-like-count").text(r.rating.statistic.like),e(".eprf-dislike-count").text(r.rating.statistic.dislike)),e("body").find(".eprf-stars-container.disabled").css({cursor:"default"}),e(".epkbfa-star").click(!1),e("body").find(".eprf-like-dislike-module__buttons .eprf-rate-like, .eprf-like-dislike-module__buttons .eprf-rate-dislike").css({cursor:"default"}),e("body").find(".eprf-like-dislike-module__buttons .eprf-rate-like, .eprf-like-dislike-module__buttons .eprf-rate-dislike").click(!1),e(".eprf-like-dislike-module").addClass("eprf-rating--blocked")}).fail(function(e,t,r){msg=eprf_vars.msg_try_again+". ["+(r||eprf_vars.unknown_error)+"]"})}function r(t,r){t.find(".eprf-stars__top-lay").hide(),t.find(".eprf-stars__inner-background .epkbfa").removeClass("epkbfa-star").removeClass("epkbfa-star-o").removeClass("epkbfa-star-half-o"),$i=0,t.find(".eprf-stars__inner-background .epkbfa").each(function(){r>=$i+1?e(this).addClass("epkbfa-star").removeClass("epkbfa-star-o").removeClass("epkbfa-star-half-o"):r>=$i+.5?e(this).removeClass("epkbfa-star").removeClass("epkbfa-star-o").addClass("epkbfa-star-half-o"):e(this).removeClass("epkbfa-star").addClass("epkbfa-star-o").removeClass("epkbfa-star-half-o"),$i++})}function a(t){const r=r=>{$target=e(r.target),$target.closest(t).length||$target.context.className.endsWith("statistics-toggle")||!e(t).is(":visible")||(e(t).hide(),a())},a=()=>{document.removeEventListener("click",r)};document.addEventListener("click",r)}e(".eprf-like-dislike-module:not(.eprf-rating--blocked) .eprf-rate-like").click(function(){return e(this).closest(".eprf-like-dislike-module").hasClass("eprf-rating--blocked")||t(5),!1}),e(".eprf-like-dislike-module:not(.eprf-rating--blocked) .eprf-rate-dislike").click(function(){return e(this).closest(".eprf-like-dislike-module").hasClass("eprf-rating--blocked")||t(1),!1}),e(document.body).on("click",".eprf-show-statistics-toggle",function(){var t,r,a=e(".eprf-stars-container");t=a.position().top+a.height(),r=a.position().left+a.width()/2;var i=e(".eprf-stars-module .eprf-stars-module__statistics");i.css({left:r-i.width()/2+"px",top:t+5+"px"})}),e(document.body).on("click",".eprf-show-statistics-toggle",function(){let t=e(".eprf-stars-module .eprf-stars-module__statistics");t.toggle(),e(t).is(":visible")&&a(t.selector)}),e(document.body).on("click",".eprf-article-meta__statistics-toggle",function(){let t=e(this).parent().find(".eprf-article-meta__statistics");t.toggle(),e(t).is(":visible")&&a(t.selector)}),e(document.body).on("open_article_feedback_form",function(){e(".eprf-article-feedback-container--trigger-negative-four").length?e(".eprf-article-feedback-container--trigger-negative-four").slideDown():e(".eprf-article-feedback-container--trigger-negative-five").length?e(".eprf-article-feedback-container--trigger-negative-five").slideDown():e(".eprf-article-feedback-container--trigger-dislike").length?e(".eprf-article-feedback-container--trigger-dislike").slideDown():e(".eprf-form-row").slideDown(),e("#eprf-article-feedback-container button").text(e("#eprf-article-feedback-container button").data("submit_text")).addClass("openned")}),e(document.body).on("click",".eprf-trigger-button button",function(){if(!e(this).hasClass("openned"))return e(document.body).trigger("open_article_feedback_form"),!1}),e(".eprf-leave-feedback-form").submit(function(){var t={action:"eprf-add-comment",kb_id:eprf_vars.kb_id,article_id:e(".kb-article-id").prop("id"),_wpnonce_user_comment_action_ajax:eprf_feedback_nonce,name:"",email:"",comment:""};return e("#eprf-form-name").length&&(t.name=e("#eprf-form-name").val()),e("#eprf-form-email").length&&(t.email=e("#eprf-form-email").val()),e("#eprf-form-text").length&&(t.comment=e("#eprf-form-text").val()),e.ajax({type:"GET",dataType:"json",data:t,url:eprf_vars.ajaxurl,beforeSend:function(t){e("#eprf-current-rating").html('<div class="eprf-article-buttons__feedback-confirmation__loading"><div class="eprf-article-buttons__feedback-confirmation__loading__icon epkbfa epkbfa-spinner"></div> '+e("#eprf-current-rating").data("loading")+"</div>")}}).done(function(t){e("#eprf-current-rating").html(t.message),e("#eprf-article-feedback-container").slideUp()}).fail(function(e,t,r){msg=eprf_vars.msg_try_again+". ["+(r||eprf_vars.unknown_error)+"]"}),!1}),e(document.body).on("update_view mouseout",".eprf-stars-container",function(t){if(!e(this).hasClass("disabled")){var a=e(this).data("average");r(e(this),a)}}),e(document.body).on("mousemove",".eprf-stars-container",function(t){if(!e(this).hasClass("disabled")&&0==e(this).closest(".eprf-rating--blocked").length){var a=Math.round((t.pageX-e(this).offset().left)/e(this).width()*10)/2;r(e(this),a)}}),e(document.body).on("click",".eprf-stars-container",function(r){if(!e(this).hasClass("disabled")&&0==e(this).closest(".eprf-rating--blocked").length){var a=Math.round((r.pageX-e(this).offset().left)/e(this).width()*10)/2;e(this).data("average",a).trigger("update_view"),t(a)}}),e(".eprf-stars-container").length&&e(".eprf-stars-container").trigger("update_view")});