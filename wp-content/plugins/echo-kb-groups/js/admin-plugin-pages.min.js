jQuery(document).ready(function(t){t("#amgp-ajax-in-progress").dialog({resizable:!1,height:70,width:200,modal:!1,autoOpen:!1}).hide();var e,a=t("#ekcb-licenses");function i(){t("#amgp_license_check").html("");n("GET",{action:"amgp_handle_license_request",command:"get_license_info"},"Retrieving license status. Please wait.")}function n(e,a,i){var n;t(".eckb-top-notice-message").html(""),t.ajax({type:e,dataType:"json",data:a,url:ajaxurl,beforeSend:function(e){t("#amgp-ajax-in-progress").text(i).dialog("open")}}).done(function(e){if((e=e||"").message||void 0===e.output)n=e.message?e.message:d("","KB Groups: Error occurred. Please try again later. (L01)","error");else{var a=void 0!==e.output&&e.output?e.output:d("","Please reload the page and try again (L37).","error");t("#amgp_license_check").html(a)}}).fail(function(e,a,i){n=d("KB Groups: Error occurred. Please try again later. (L02)",n=i?" ["+i+"]":"unknown error","error")}).always(function(){t("#amgp-ajax-in-progress").dialog("close"),n&&(t(".eckb-top-notice-message").replaceWith(n),t("html, body").animate({scrollTop:0},"slow"))})}if(t("#eckb_license_tab").hasClass("active")&&i(),t("#wpbody").on("click","#eckb_license_tab",function(e){i()}),a.on("click","#amgp_save_btn",function(e){e.preventDefault(),n("POST",{action:"amgp_handle_license_request",amgp_license_key:t("#amgp_license_key").val().trim(),_wpnonce_amgp_license_key:t("#_wpnonce_amgp_license_key").val(),command:"save"},"Saving license...")}),t("#posts-filter .search-box").after('<input type="hidden" id="amag_chosen_kb_group" name="amag_chosen_kb_group" value="'+t("#amag_chosen_kb_group").val()+'"/>'),t(".amgp-admin-list-page-chosen-group-container").length&&t("#amag_chosen_kb_group").val()){var o="&amag_chosen_kb_group="+t("#amag_chosen_kb_group").val();t(".subsubsub").find("a").each(function(){t(this).attr("href").match("^edit.php\\?")&&t(this).attr("href").match(amgp_vars.match_article_search)&&t(this).attr("href",t(this).attr("href")+o)}),t("#the-list").find("a").each(function(){t(this).attr("href").match("^edit.php\\?")&&t(this).attr("href").match(amgp_vars.match_article_search)&&t(this).attr("href",t(this).attr("href")+o)}),t(".inline-edit-private").after('<input type="hidden" id="amag_chosen_kb_group" name="amag_chosen_kb_group" value="'+t("#amag_chosen_kb_group").val()+'"/>')}function r(){var e=t(".amgp-article-page-categories-container li"),o=[];t(".amgp-article-page-group-container li input").each(function(){t(this).is(":checked")&&o.push(parseInt(t(this).val()))}),e.removeClass("amgp-show-group-cat"),t(".amgp-group-icon-placeholder-container .amgp-group-icon-placeholder").removeClass("amgp-display-group-icon"),t(".amgp-group-icon-placeholder-container").removeClass("amgp-hide-group-icons"),t(".amgp-group-count").remove(),e.each(function(){var e=t(this).data("amgp-group-id");if(void 0!==e)for(var a=JSON.parse("["+e+"]"),i=o.length,n=0;n<=i;n++)-1!==t.inArray(o[n],a)&&(t(this).addClass("amgp-show-group-cat"),t(".amgp-group-icon-placeholder-container .amgp-group-icon-placeholder").each(function(){var e=t(this).data("amgp-group-icon-id");parseInt(o[n])===parseInt(e)&&t(this).addClass("amgp-display-group-icon")}))}),t(".amgp-group-icon-placeholder-container").each(function(){var e=t(this).find(".amgp-display-group-icon").length;2<e&&(t(this).append('<span class="amgp-group-icon-placeholder amgp-group-count">'+e+"</span>"),t(this).addClass("amgp-hide-group-icons"))})}function c(e,a){var i=0;if(!t(e).is(":checked"))var n=parseInt(t(e).val());return t(".amgp-article-page-categories-container li").each(function(){var e=t(this).data("amgp-group-id");if(void 0!==e){var a=JSON.parse("["+e+"]");-1!==t.inArray(n,a)&&t(this).find("input").is(":checked")&&(i+=1)}}),0<i?(a.preventDefault(),t(".amgp-cannot-deselect-group").remove(),t("#amgp-article-page-inner-container").prepend('<div class="amgp-cannot-deselect-group">Un-check assigned Categories</div>'),!1):(t(".amgp-cannot-deselect-group").remove(),!0)}function p(e){t(".amgp-no-categories-detected").remove(),t(e).is(":checked")&&0===t(".amgp-show-group-cat").length&&(t(".amgp-required-category").remove(),t("#amgp-article-page-inner-container").prepend('<div class="amgp-no-categories-detected">No Categories Assigned</div>'))}function g(){if(t("#amgp-group-article-access").length){t(".amgp-required-category").remove(),l("hide"),t("#amgp-article-page-inner-container").prepend('<div class="amgp-required-category">Select at least one Category.</div>');var e=1;t(".amgp-article-page-categories-container").find(" li ").each(function(){t(this).find('input[type="checkbox"]:checked').length&&(e=0)}),0===e&&(l("show"),t(".amgp-required-category").remove())}}function s(){t("#amgp-group-article-access").length&&(t(".amgp-required-group").remove(),t(".amgp-required-category").remove(),setTimeout(function(){var e=1;t("#amgp-article-page-inner-container").prepend('<div class="amgp-required-group">Select at least one Group.</div>'),t(".amgp-article-page-group-container").find(" li ").each(function(){t(this).find('input[type="checkbox"]:checked').length&&(e=0)}),0===e&&(t(".amgp-required-group").remove(),g())},1e3))}function l(e){"show"===e?t(".amgp-prevent-publishing").remove():"hide"===e&&t(".amgp-prevent-publishing").length<1&&t("#submitdiv").find(".inside").prepend('<div class="amgp-prevent-publishing"><div class="amgp-message">No Category Selected</div></div>')}if(t(".amgp-group-icon-placeholder-container").each(function(){var e=t(this).find(".amgp-group-icon-placeholder").length;2<e&&(t(this).append('<span class="amgp-group-icon-placeholder amgp-group-count">'+e+"</span>"),t(this).addClass("amgp-hide-group-icons"))}),t("body").on("click",".amgp-group-count",function(){t(this).parent().toggleClass("amgp-hide-group-icons")}),t("#amgp-group-article-access").length){var m=t("#post_type").val();t("#"+m+"_categorydiv").remove()}function d(e,a,i){return'<div class="eckb-top-notice-message"><div class="contents"><span class="'+i+'">'+(e?"<h4>"+e+"</h4>":"")+(a||"")+"</span></div></div>"}if(0===t(".amgp-admin-categories").length&&(l("hide"),s(),r(),1===t(".amgp-article-page-group-container li").length&&(t('.amgp-article-page-group-container li input[type="checkbox"]').prop("checked",!0),r()),t(t("#amgp-group-article-access").on("click","input",function(e){c(t(this),e)&&(s(),p(t(this)))})),t(t(".amgp-article-page-group-container").on("click","input",function(e){c(t(this),e)&&(r(),p(t(this)))}))),1===t(".amgp-admin-categories").length&&(t(t("#amgp-group-article-access").on("click","input",function(e){g()})),setTimeout(function(){g()},1e3)),t("#wpbody").on("click","[id^=amag_chosen_kb_group_article_switch_kb_choice_]",function(e){e.preventDefault(),function(){if(0<t(".amag-ajax-loading-saving-icon").length)return;t(".amag-private-admin").find(".amag-ajax-loading-saving-icon").remove();t(".amag-private-admin").append('<div class="amag-ajax-loading-saving-icon"><div class="amag-loading-spinner"></div></div>')}(),function(e,a,i){var n;t.ajax({type:e,dataType:"json",data:a,url:ajaxurl,beforeSend:function(e){t("#amgp-ajax-in-progress").text(i).dialog("open")}}).done(function(e){(e=e||"").message||void 0===e.amag_chosen_kb_group?n=e.message?e.message:d("","Access Manager: Error occurred. Please try again later. (L01)","error"):window.location.href=window.location.href+"&amag_chosen_kb_group="+e.amag_chosen_kb_group}).fail(function(e,a,i){n=d("Access Manager: Error occurred. Please try again later. (L02)",n=i?" ["+i+"]":"unknown error","error")}).always(function(){t("#amgp-ajax-in-progress").dialog("close"),n&&(t(".eckb-bottom-notice-message").replaceWith(n),t("html, body").animate({scrollTop:0},"slow"))})}("POST",{action:"amgp_switch_kb_group_on_article_page",_wpnonce_amgp_article_switch_kb:t("#_wpnonce_amgp_article_switch_kb").val(),amgp_kb_id:t("#amgp_kb_id").val(),amag_chosen_kb_group:t(this).val()},"Switching KB Group...")}),t(".wp-list-table.posts").on("click",".editinline",function(){t(".wp-list-table.posts").find(".epkb_post_type_1_category-checklist").each(function(){t(this).hide(),t(this).after("<span>Quick edit of categories not available</span>")})}),t(".amgp-admin-list-page-chosen-group-container").length){t(".amgp-radio-checked").length&&t("#col-container").show();var u=t(".amgp-admin-list-page-chosen-group-container").clone();t(".amgp-admin-list-page-chosen-group-container").remove(),t(".wp-heading-inline").after(u)}else t("#col-container").show();function h(e){var a="#amgp_kb_section_group_id_"+e;t(".amgp_kb_mode").hide(),t(a).show()}t(".amag-private-admin").find(".amgp-admin-list-page-chosen-group-container").fadeIn(),e=t("#amgp-main-page-group-selection"),t(".amgp_kb_mode").hide(),e.val()&&h(e.val()),t("body").on("change","#amgp-main-page-group-selection",function(e){h(t(this).val())})});