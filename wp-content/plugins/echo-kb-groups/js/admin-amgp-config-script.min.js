jQuery(document).ready(function(t){var g=t("#amag-access-manager-container"),e=t("#amgp-kb-groups-content"),n=t("#amgp-users-content");function o(a){e.html(),e.html(a.message),t(".amag-config-content").hide(),t("#amgp-kb-groups-content").show()}function i(e,n){g.find("#amag-delete-group-box").on("click","#amag-notification-box-apply-js",function(){var a=0;t(".amag-notification-box").find(" .amag-body-checkboxes li ").each(function(){0<!t(this).find('input[type="checkbox"]:checked').length&&(a=1,t(".eckb-bottom-notice-message").replaceWith(b("","Must check all checkboxes before Deleting group","error")))}),0===a&&(f(),c("amgp_delete_kb_group_ajax",n,e,r),t("#amag-delete-group-box").hide())})}function c(a,e,n,o){var i=s(e,n);if(i)return t(".eckb-bottom-notice-message").replaceWith(i),void t("html, body").animate({scrollTop:0},"slow");u({action:a,amag_kb_id:t("#amag_kb_id").val(),amgp_kb_group_name:n,amgp_kb_group_id:e,_wpnonce_amar_access_content_action_ajax:t("#_wpnonce_amar_access_content_action_ajax").val()},o)}function s(a,e){return!(!e||e.size<3)&&(!(!a||"0"===a)&&"")}function r(){var a={action:"amgp_add_kb_groups_tabs_ajax",amag_kb_id:t("#amag_kb_id").val(),_wpnonce_amar_access_content_action_ajax:t("#_wpnonce_amar_access_content_action_ajax").val()};t("#amgp-delete-group-box").hide(),u(a,o)}function p(a){n.html(),n.html(a.message),t(".amag-config-content").hide(),n.show()}function l(){var a=n.find("#amgp-user-tabs-kb-group-list").find(":selected").val(),e=t("#amgp-users-content .amgp-nav-tabs .amag-active-tab").attr("id");"0"===a&&t(".amgp-user-tabs-container").remove(),u({action:"amgp_add_kb_user_roles_tabs_ajax",amag_kb_id:t("#amag_kb_id").val(),amgp_kb_group_id:a,amgp_active_role:e,_wpnonce_amar_access_content_action_ajax:t("#_wpnonce_amar_access_content_action_ajax").val()},p)}function _(a,e,n,o){var i;if(i=function(a,e,n){if(!e||e.size<3)return b("","Role name is invalid.","error");return a&&"0"!==a?"0"!==n?"":b("","Select User first.","error"):b("","Select Group first.","error")}(e,n,o))return t(".eckb-bottom-notice-message").replaceWith(i),void t("html, body").animate({scrollTop:0},"slow");u({action:a,amag_kb_id:t("#amag_kb_id").val(),amgp_kb_role_name:n,amgp_wp_user_id:o,amgp_kb_group_id:e,_wpnonce_amar_access_content_action_ajax:t("#_wpnonce_amar_access_content_action_ajax").val()},l)}function m(a){t("#amgp-control-"+a.role).html(),t("#amgp-control-"+a.role).html(a.message)}function d(a){t("#amgp-user-tabs-section").html(a.message)}function u(a,e,n){var o,i;e=void 0===e?"amgp_callback_noop":e;t.ajax({type:"POST",dataType:"json",data:a,url:ajaxurl,beforeSend:function(a){t("#amgp-ajax-in-progress").text("Working ...").dialog("open")}}).done(function(a){!(i=a||"").error&&void 0!==i.message||(o=i.message?i.message:b("",amgp_vars.reload_try_again,"error"))}).fail(function(a,e,n){o=n?" ["+n+"]":amgp_vars.unknown_error,o=b(amgp_vars.error_occurred+". "+amgp_vars.msg_try_again,o,"error")}).always(function(){t("#amgp-ajax-in-progress").dialog("close"),o?(g.find(".amag-ajax-loading-saving-icon").remove(),t(".eckb-bottom-notice-message").replaceWith(o)):(function(){if(0!==t(".amag-ajax-loading-saving-icon").length){var a;g.find(".amag-loading-spinner").after('<div class="epkbfa epkbfa-check-circle"></div>'),g.find(".amag-loading-spinner").remove(),clearTimeout(a),a=setTimeout(function(){g.find(".amag-ajax-loading-saving-icon").remove()},1e3)}}(),"function"==typeof e?e(i=void 0===i?"":i):n&&location.reload())})}function f(){if(!(0<t(".amag-ajax-loading-saving-icon").length)){g.find(".amag-ajax-loading-saving-icon").remove();g.append('<div class="amag-ajax-loading-saving-icon"><div class="amag-loading-spinner"></div></div>')}}function b(a,e,n){return'<div class="eckb-bottom-notice-message"><div class="contents"><span class="'+n+'">'+(a?"<h4>"+a+"</h4>":"")+(e||"")+'</span></div><div class="amgp-close-notice epkbfa epkbfa-window-close"></div></div>'}g.find("#amgr-config-main-nav").on("click",".amag-nav-button",function(){if(!(0<t(".amag-ajax-loading-saving-icon").length)){var a=t(this).attr("id");"amag-users"===a?(f(),l()):"amag-groups"===a&&(f(),r())}}),e.on("click","#amgp-add-group",function(){t(this).toggleClass("amgp-btn-active"),t("#amgp-add-group-input").fadeToggle().css("display","inline-block")}),e.on("click","#amgp_add_kb_group_ajax",function(){var a=t("#create-group-name").val();f(),c("amgp_add_kb_group_ajax",0,a,r),e.find("#amgp-add-group").removeClass("amgp-btn-active"),e.find("#create-group-name").val(" "),t("#amgp-add-group-input").fadeOut()}),e.on("click",".amag-rename-group-toggle",function(a){a.preventDefault(),t(this).parent().find(".amgp-rename-group-input").fadeToggle().css("display","inline-block")}),e.on("click","[id^=amgp_rename_kb_group_ajax]",function(a){a.preventDefault();var e=t(this).parent().parent().find(".amgp_kb_group_id").val(),n=t(this).parent().find("#rename-group-name"+e).val();f(),c("amgp_rename_kb_group_ajax",e,n,r)}),e.on("click","[id^=amgp-delete-kb-group]",function(){t(".amgp-popup").remove();var a=t(this).parent().find(".amgp_kb_group_id").val(),e=t(this).parent().find(".amgp_kb_group_name").val(),n=s(a,e);if(n)return t(".eckb-bottom-notice-message").replaceWith(n),void t("html, body").animate({scrollTop:0},"slow");!function(a){var e="";e+='<div id="'+a.id+'" class="amag-notification-box amag-popup">',e+='<form class="'+a.type+'">',e+='<section class="amag-header"><h3>'+a.header+"</h3></section>",e+='<section class="amag-body">',a.content&&(e+='<div class="amag-body-content">'+a.content+"</div>");if(a.checkboxes){e+='<div class="amag-body-checkboxes">';var n=a.checkboxes.length;e+="<ul>";for(var o=0;o<n;o++)e+='<li><label for="checkbox_'+o+'">'+a.checkboxes[o]+'</label><input type="checkbox" name="checkbox_'+o+'" id="checkbox_'+o+'" required></li>';e+="</ul>",e+="</div>"}e+="</section>",e+='<section class="amgp-footer">',e+='<button type="button" id="amag-notification-box-apply-js" class="amag-error-btn">'+a.apply_button+"</button>",a.cancel_button&&(e+='<button type="button" id="amag-notification-box-cancel" class="amag-success-btn">'+a.cancel_button+"</button>");e+="</section>",e+="</form>",e+="</div>",t("#amag-access-manager-container").append(e),a.apply_function(a.kb_group_name,a.kb_group_id),g.find(".amag-popup").on("click","#amag-notification-box-cancel",function(a){a.preventDefault(),t(".amag-popup").remove()})}({id:"amag-delete-group-box",type:"amag-error",kb_group_name:e,kb_group_id:a,apply_function:i,header:"Deleting Group "+e,content:"<p>Deleting this group will remove all access to all users assigned to this group.</p>",checkboxes:["I understand that all settings assigned to this group will be lost.","I acknowledge that this change is not reversible."],apply_button:"Delete Group",cancel_button:"Cancel"})}),n.on("change","#amgp-user-tabs-kb-group-list",function(){"0"!==t("#amgp-user-tabs-kb-group-list").find(":selected").val()?(f(),l()):t(".amgp-user-tabs-container").remove()}),n.on("click",".amgp_add_kb_group_user_ajax",function(){var a=t("#amgp-user-tabs-kb-group-list").find(":selected").val(),e=t(this).closest(".amgp-group-roles").find(".amgp_kb_role_name").val(),n=t(this).closest(".amgp-user-record").find(".amgp-wp-user-id").val();0<n&&f(),_("amgp_add_kb_group_user_ajax",a,e,n)}),n.on("click",".amgp_remove_kb_group_user_ajax",function(){var a=t(this).parent().find(".amgp-wp-user-id").val(),e=t(this).closest(".amgp-group-roles").find(".amgp_kb_role_name").val(),n=t("#amgp-user-tabs-kb-group-list").find(":selected").val();f(),_("amgp_remove_kb_group_user_ajax",n,e,a)}),n.on("click","a",function(a){a.preventDefault();var e={action:"amgp_get_user_page_ajax",amag_kb_id:t("#amag_kb_id").val(),amgp_kb_group_id:t("#amgp-user-tabs-kb-group-list").find(":selected").val(),amgp_kb_role_name:t(this).closest(".amgp-group-roles").find(".amgp_kb_role_name").val(),amag_current_page_number:t("#ammgp-page-number").data("page-number"),amag_next_page_number:t(this).text(),_wpnonce_amgp_get_user_page_ajax:t("#_wpnonce_amgp_get_user_page_ajax").val()};f(),u(e,m)}),n.on("click","#amgp_filter_users",function(a){a.preventDefault();var e=t(this).closest(".amgp-group-roles").find(".amgp_kb_role_name").val(),n={action:"amgp_filter_users_ajax",amag_kb_id:t("#amag_kb_id").val(),amgp_kb_group_id:t("#amgp-user-tabs-kb-group-list").find(":selected").val(),amgp_kb_role_name:e,amag_user_filter:t("#amgp_user_filter-"+e).val(),_wpnonce_amgp_get_user_page_ajax:t("#_wpnonce_amgp_get_user_page_ajax").val()};f(),u(n,m)}),t("#amgp-access-save-configuration-container").on("click","#amgp_save_kb_config",function(a){a.preventDefault(),f(),u({action:"amgp_save_kb_config_changes",amag_kb_id:t("#amag_kb_id").val(),form:t("#amgp-access-configuration").serialize(),_wpnonce_amgp_save_kb_config:t("#_wpnonce_amgp_save_kb_config").val()},d)}),g.find(".amag-notification-box").on("click",".amag-content-toggle",function(){t(this).parents(".amag-collapse").find(".amag-body-checkboxes").fadeToggle(100),t(this).parents(".amag-collapse").find(".amgp-footer").fadeToggle(100),t(this).parents(".amag-collapse").find(".fa").toggleClass("fa-arrow-circle-down fa-arrow-circle-up"),t(this).parents(".amag-collapse").toggleClass("amag-active-toggle")}),g.on("click",".amgp-toggle-box-header",function(){t(this).parent().toggleClass("amgp-toggle-closed amgp-toggle-open "),t(this).find(".amgp-toggle-box-icon").toggleClass("fa-arrow-circle-down fa-arrow-circle-up ")}),g.on("click",".amgp-info-box-icon",function(){t(this).parent().toggleClass("amgp-info-toggle-closed amgp-info-toggle-open ")}),g.on("click",".amgp-info-box-close",function(){t(this).parents(".amgp-info-box").toggleClass("amgp-info-toggle-closed amgp-info-toggle-open ")}),g.on("click",".amgp-info-box-icon-max",function(){t(this).parents(".amgp-info-box").addClass("amgp-info-max-size"),t(this).hide(),t(this).parent().find(".amgp-info-box-icon-min").show()}),g.on("click",".amgp-info-box-icon-min",function(){t(this).parents(".amgp-info-box").removeClass("amgp-info-max-size"),t(this).hide(),t(this).parent().find(".amgp-info-box-icon-max").show()})});